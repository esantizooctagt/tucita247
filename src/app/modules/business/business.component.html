<div class="container-fluid h-100">
    <div class="row row pl-2 pr-1">
        <div class="pl-15 pt-1 pb-2 col-md-12 mt-1 mb-1 header-route">
            <h4>Business</h4>
        </div>
        <div class="pl-15 pt-1 col-md-12">
            <mat-horizontal-stepper labelPosition="bottom" linear #stepper>
                <ng-template matStepperIcon="business">
                    <mat-icon>business</mat-icon>
                </ng-template>
                <ng-template matStepperIcon="location">
                    <mat-icon>location</mat-icon>
                </ng-template>
                <!-- Custom icon with a context variable. -->
                <ng-template matStepperIcon="number" let-index="index">
                    <mat-icon>business</mat-icon>
                    <!-- {{index + 10}} -->
                </ng-template>
                <ng-container *ngIf="(businessSave$ | async) && savingBusiness"></ng-container>
                <mat-step [stepControl]="businessForm" step="business" *ngIf="(business$ | async) || displayBusiness">
                    <form [formGroup]="businessForm" (ngSubmit)="onSubmitBusiness()">
                        <ng-template matStepLabel>Business</ng-template>
                        <mat-form-field>
                            <input matInput placeholder="Business Name" maxlength="500" minlength="3" formControlName="Name" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Name.invalid && fBusiness.Name.touched">{{getErrorMessage('Name')}}</mat-error>
                        </mat-form-field>
                        <mat-form-field>
                            <input matInput placeholder="Address" formControlName="Address" maxlength="500" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Address.invalid && fBusiness.Address.touched">{{getErrorMessage('Address')}}</mat-error>
                        </mat-form-field>
                        <div class="row">
                            <mat-form-field class="col-md-2">
                                <input matInput placeholder="House No" formControlName="House_No" maxlength="10" minlength="2" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.House_No.invalid && fBusiness.House_No.touched">{{getErrorMessage('House_No')}}</mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-md">
                                <input matInput placeholder="Phone" formControlName="Phone" maxlength="30" minlength="3" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.Phone.invalid && fBusiness.Phone.touched">{{getErrorMessage('Phone')}}</mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="Postal Code" formControlName="Postal_Code" maxlength="50" minlength="3" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.Postal_Code.invalid && fBusiness.Postal_Code.touched">{{getErrorMessage('Postal_Code')}}</mat-error>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col-md">
                                <input type="text" placeholder="Country" matInput formControlName="Country" [matAutocomplete]="autoCountry" [errorStateMatcher]="confirmValidParentMatcher" required>
                                <mat-error *ngIf="fBusiness.Country.invalid && fBusiness.Country.touched">{{getErrorMessage('Country')}}</mat-error>
                                <mat-autocomplete #autoCountry="matAutocomplete" [displayWith]="displayFn" activeOption="activeOption">
                                    <mat-option *ngFor="let country of filteredCountries$ | async" [value]="country">
                                    {{country.n}}
                                    </mat-option>
                                </mat-autocomplete>
                            </mat-form-field>
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="State" formControlName="State" maxlength="100" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                                <mat-error *ngIf="fBusiness.State.invalid && fBusiness.State.touched">{{getErrorMessage('State')}}</mat-error>
                            </mat-form-field>

                        </div>
                        <mat-form-field>
                            <input matInput placeholder="Tax Number" formControlName="Tax_Number" maxlength="50" minlength="2" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Tax_Number.invalid && fBusiness.Tax_Number.touched">{{getErrorMessage('Tax_Number')}}</mat-error>
                        </mat-form-field>
                        <mat-form-field>
                            <input matInput placeholder="Email" formControlName="Email" pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Email.invalid && fBusiness.Email.touched">{{getErrorMessage('Email')}}</mat-error>
                        </mat-form-field>
                        <!-- <div class="form-field pr-3">
                            <mat-label class="">
                                Language : 
                            </mat-label>English
                        </div> -->
                        <div class="form-field pr-3">
                            <mat-label class="">
                                Number of Locations : 
                            </mat-label>{{fBusiness.Location_No.value}}
                        </div>
                       
                        <div>
                            <button class="mr-3 mt-2" mat-flat-button color="primary" [disabled]="businessForm.invalid" matStepperNext>Save / Next</button>
                        </div>
                    </form>
                </mat-step>
                <ng-container *ngIf="(locationSave$ | async) && savingLocation"></ng-container>
                <mat-step [stepControl]="locationForm" step="location" *ngIf="(location$ | async) || displayLocation">
                    <form [formGroup]="locationForm" (ngSubmit)="onSubmitLocations()">
                        <ng-template matStepLabel>Locations</ng-template>
                        <mat-accordion>
                            <ng-container class="" formArrayName="locations" *ngFor="let item of fLocations.controls; let i = index;">
                                <ng-container [formGroupName]="i">
                                    <mat-expansion-panel>
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                {{ 'Name : ' + item.value.Name }}
                                            </mat-panel-title>
                                            <mat-panel-description *ngIf="!(isHandset$ | async)">
                                                {{ 'Address : ' + item.value.Address }}
                                            </mat-panel-description>
                                        </mat-expansion-panel-header>
                                        <mat-form-field>
                                            <input matInput placeholder="Location Name" formControlName="Name" maxlength="500" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                                            <mat-error *ngIf="item.get('Name').invalid">{{getErrorMessage('SName', i)}}</mat-error>
                                        </mat-form-field>
                                        <mat-form-field>
                                            <input matInput placeholder="Address" formControlName="Address" maxlength="500" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                                            <mat-error *ngIf="item.get('Address').invalid">{{getErrorMessage('SAddress', i)}}</mat-error>
                                        </mat-form-field>
                                        <div class="row">
                                            <mat-form-field class="col-md-3">
                                                <input matInput placeholder="Postal Code" formControlName="Postal_Code" maxlength="50" minlength="3" [errorStateMatcher]="confirmValidParentMatcher">
                                                <mat-error *ngIf="item.get('Postal_Code').invalid">{{getErrorMessage('SPostal_Code', i)}}</mat-error>
                                            </mat-form-field>
                                            <mat-form-field class="col-md">
                                                <input matInput placeholder="Tax Number" formControlName="Tax_Number" maxlength="50" minlength="2" [errorStateMatcher]="confirmValidParentMatcher" required>
                                                <mat-error *ngIf="item.get('Tax_Number').invalid">{{getErrorMessage('STax_Number', i)}}</mat-error>
                                            </mat-form-field>
                                            <!-- <mat-form-field class="col-md-4">
                                                <input matInput placeholder="Cashier No" formControlName="Cashier_No" required>
                                            </mat-form-field> -->
                                            <!-- || !validCashier -->
                                        </div>
                                        <div class="form-field-check">
                                            <mat-checkbox formControlName="Status">Status</mat-checkbox>
                                        </div>
                                    </mat-expansion-panel>
                                </ng-container>
                            </ng-container>
                        </mat-accordion>
                        <div>
                            <button class="mr-3 mt-2" mat-flat-button color="accent" matStepperPrevious>Back</button>
                            <button class="mr-3 mt-2" mat-flat-button color="primary" [disabled]="locationForm.invalid" matStepperNext>Save / Next</button>
                        </div>
                    </form>
                </mat-step>
            </mat-horizontal-stepper>              
        </div>
    </div>
</div>
