<div class="container-fluid h-100">
    <div class="row row pl-2 pr-1">
        <div class="pl-15 pt-1 pb-2 col-md-12 mt-1 mb-1 header-route">
            <h4>Business</h4>
        </div>
        <div class="pl-15 pt-1 col-md-12">
            <mat-horizontal-stepper labelPosition="bottom" linear #stepper>
                <ng-template matStepperIcon="business">
                    <mat-icon>business</mat-icon>
                </ng-template>
                <ng-template matStepperIcon="location">
                    <mat-icon>location</mat-icon>
                </ng-template>
                <!-- Custom icon with a context variable. -->
                <ng-template matStepperIcon="number" let-index="index">
                    <mat-icon>business</mat-icon>
                    <!-- {{index + 10}} -->
                </ng-template>
                <ng-container *ngIf="(businessSave$ | async) && savingBusiness"></ng-container>
                <mat-step [stepControl]="businessForm" step="business" *ngIf="(business$ | async) || displayBusiness">
                    <form [formGroup]="businessForm" (ngSubmit)="onSubmitBusiness()">
                        <ng-template matStepLabel>Business</ng-template>
                        <mat-form-field>
                            <input matInput placeholder="Business Name" maxlength="500" minlength="3" formControlName="Name" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Name.invalid && fBusiness.Name.touched">{{getErrorMessage('Name')}}</mat-error>
                        </mat-form-field>
                        <mat-form-field>
                            <input matInput placeholder="Address" formControlName="Address" maxlength="500" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Address.invalid && fBusiness.Address.touched">{{getErrorMessage('Address')}}</mat-error>
                        </mat-form-field>
                        <div class="row">
                            <mat-form-field class="col-md">
                                <input type="text" placeholder="Country" matInput formControlName="Country" [matAutocomplete]="autoCountry" [errorStateMatcher]="confirmValidParentMatcher" required>
                                <mat-error *ngIf="fBusiness.Country.invalid && fBusiness.Country.touched">{{getErrorMessage('Country')}}</mat-error>
                                <mat-autocomplete #autoCountry="matAutocomplete" [displayWith]="displayFn" activeOption="activeOption">
                                    <mat-option *ngFor="let country of filteredCountries$ | async" [value]="country">
                                    {{country.n}}
                                    </mat-option>
                                </mat-autocomplete>
                            </mat-form-field>
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="City" formControlName="City" [errorStateMatcher]="confirmValidParentMatcher" required>
                                <mat-error *ngIf="fBusiness.City.invalid && fBusiness.City.touched">{{getErrorMessage('City')}}</mat-error>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col-md-2">
                                <input matInput placeholder="Zip Code" formControlName="ZipCode" maxlength="10" minlength="5" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.ZipCode.invalid && fBusiness.ZipCode.touched">{{getErrorMessage('ZipCode')}}</mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-md">
                                <span matPrefix>+1 &nbsp;</span>
                                <input matInput appPhoneMask placeholder="Phone" formControlName="Phone" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.Phone.invalid && fBusiness.Phone.touched">{{getErrorMessage('Phone')}}</mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="WebSite" formControlName="WebSite" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.WebSite.invalid && fBusiness.WebSite.touched">{{getErrorMessage('WebSite')}}</mat-error>
                            </mat-form-field>
                        </div>
                        <div class="row">
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="Facebook" formControlName="Facebook" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.Facebook.invalid && fBusiness.Facebook.touched">{{getErrorMessage('Facebook')}}</mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="Twitter" formControlName="Twitter" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.Twitter.invalid && fBusiness.Twitter.touched">{{getErrorMessage('Twitter')}}</mat-error>
                            </mat-form-field>
                            <mat-form-field class="col-md-4">
                                <input matInput placeholder="Instagram" formControlName="Instagram" [errorStateMatcher]="confirmValidParentMatcher">
                                <mat-error *ngIf="fBusiness.Instagram.invalid && fBusiness.Instagram.touched">{{getErrorMessage('Instagram')}}</mat-error>
                            </mat-form-field>
                        </div>
                        <mat-form-field>
                            <input type="text" placeholder="Categories" matInput formControlName="Categories" [matAutocomplete]="autoCategories" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.Categories.invalid && fBusiness.Categories.touched">{{getErrorMessage('Categories')}}</mat-error>
                            <mat-autocomplete #autoCategories="matAutocomplete" [displayWith]="displayFnCat" activeOption="activeOption">
                                <mat-option *ngFor="let category of categories$ | async" [value]="category">
                                {{category.Name}}
                                </mat-option>
                            </mat-autocomplete>
                        </mat-form-field>
                        <mat-chip-list>
                            <mat-chip *ngFor="let item of categories">{{item.Name}}</mat-chip>
                        </mat-chip-list>
                        <!-- <mat-form-field>
                            <input matInput placeholder="Tags" pattern="^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" [errorStateMatcher]="confirmValidParentMatcher">
                            <mat-error *ngIf="fBusiness.Tags.invalid && fBusiness.Tags.touched">{{getErrorMessage('Tags')}}</mat-error>
                        </mat-form-field> -->
                        <mat-form-field>
                            <mat-chip-list #chipList>
                                <mat-chip *ngFor="let item of tags" [selectable]="selectable"
                                            [removable]="removable" (removed)="remove(item)">{{item}}
                                    <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
                                </mat-chip>
                                <input placeholder="New Tag..."
                                        [matChipInputFor]="chipList"
                                        [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                        [matChipInputAddOnBlur]="addOnBlur"
                                        (matChipInputTokenEnd)="add($event)">
                            </mat-chip-list>
                        </mat-form-field>
                        <!-- <mat-form-field>
                            <input matInput placeholder="OperationHours" formControlName="OperationHours" [errorStateMatcher]="confirmValidParentMatcher" required>
                            <mat-error *ngIf="fBusiness.OperationHours.invalid && fBusiness.OperationHours.touched">{{getErrorMessage('OperationHours')}}</mat-error>
                        </mat-form-field> -->

                        <div class="col-md-6 mt-3 mb-3">
                            <mat-label class="">Operation Hours</mat-label>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Mon</mat-label>
                                <mat-checkbox formControlName="MonEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(0, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Mon" [options]="optionsMon"></ng5-slider>
                                </div>
                                <button mat-icon-button aria-label="" class="dayAdd">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Tue</mat-label>
                                <mat-checkbox formControlName="TueEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(1, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Tue" [options]="optionsTue"></ng5-slider>
                                </div>
                                <button mat-icon-button aria-label="" class="dayAdd">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Wed</mat-label>
                                <mat-checkbox formControlName="WedEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(2, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Wed" [options]="optionsWed"></ng5-slider>
                                </div>
                                <button mat-icon-button aria-label="" class="dayAdd">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Thu</mat-label>
                                <mat-checkbox formControlName="ThuEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(3, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Thu" [options]="optionsThu"></ng5-slider>
                                </div>
                                <button mat-icon-button aria-label="" class="dayAdd">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Fri</mat-label>
                                <mat-checkbox formControlName="FriEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(4, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Fri" [options]="optionsFri"></ng5-slider>
                                </div>
                                <button mat-icon-button aria-label="" class="dayAdd">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Sat</mat-label>
                                <mat-checkbox formControlName="SatEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(5, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Sat" [options]="optionsSat"></ng5-slider>
                                </div>
                                <button mat-icon-button aria-label="" class="dayAdd">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="row pb-2">
                                <mat-label class="col-md-1 ml-3 mr-6 dayText">Sun</mat-label>
                                <mat-checkbox formControlName="SunEnabled" class="col-md-1 pr-2 pl-2 ml-3 mr-3 dayCheckBox" (change)="onChangeDisabled(6, $event)"></mat-checkbox>
                                <div class="slider">
                                    <ng5-slider formControlName="Sun" [options]="optionsSun"></ng5-slider>
                                </div>
                                <button mat-stroked-button color="primary">+ Intervalo Adicional</button>
                            </div>
                        </div>
                        <div>
                            <button class="mr-3 mt-2" mat-flat-button color="primary" [disabled]="businessForm.invalid" matStepperNext>Save / Next</button>
                        </div>
                        {{ businessForm.value | json }}
                        {{ tags | json}}
                    </form>
                </mat-step>
                <ng-container *ngIf="(locationSave$ | async) && savingLocation"></ng-container>
                <mat-step [stepControl]="locationForm" step="location" *ngIf="(location$ | async) || displayLocation">
                    <form [formGroup]="locationForm" (ngSubmit)="onSubmitLocations()">
                        <ng-template matStepLabel>Locations</ng-template>
                        <mat-accordion>
                            <ng-container class="" formArrayName="locations" *ngFor="let item of fLocations.controls; let i = index;">
                                <ng-container [formGroupName]="i">
                                    <mat-expansion-panel>
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                {{ 'Name : ' + item.value.Name }}
                                            </mat-panel-title>
                                            <mat-panel-description *ngIf="!(isHandset$ | async)">
                                                {{ 'Address : ' + item.value.Address }}
                                            </mat-panel-description>
                                        </mat-expansion-panel-header>
                                        <mat-form-field>
                                            <input matInput placeholder="Location Name" formControlName="Name" maxlength="500" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                                            <mat-error *ngIf="item.get('Name').invalid">{{getErrorMessage('SName', i)}}</mat-error>
                                        </mat-form-field>
                                        <mat-form-field>
                                            <input matInput placeholder="Address" formControlName="Address" maxlength="500" minlength="3" [errorStateMatcher]="confirmValidParentMatcher" required>
                                            <mat-error *ngIf="item.get('Address').invalid">{{getErrorMessage('SAddress', i)}}</mat-error>
                                        </mat-form-field>
                                        <div class="row">
                                            <mat-form-field class="col-md-3">
                                                <input matInput placeholder="Postal Code" formControlName="Postal_Code" maxlength="50" minlength="3" [errorStateMatcher]="confirmValidParentMatcher">
                                                <mat-error *ngIf="item.get('Postal_Code').invalid">{{getErrorMessage('SPostal_Code', i)}}</mat-error>
                                            </mat-form-field>
                                            <mat-form-field class="col-md">
                                                <input matInput placeholder="Tax Number" formControlName="Tax_Number" maxlength="50" minlength="2" [errorStateMatcher]="confirmValidParentMatcher" required>
                                                <mat-error *ngIf="item.get('Tax_Number').invalid">{{getErrorMessage('STax_Number', i)}}</mat-error>
                                            </mat-form-field>
                                            <!-- <mat-form-field class="col-md-4">
                                                <input matInput placeholder="Cashier No" formControlName="Cashier_No" required>
                                            </mat-form-field> -->
                                            <!-- || !validCashier -->
                                        </div>
                                        <div class="form-field-check">
                                            <mat-checkbox formControlName="Status">Status</mat-checkbox>
                                        </div>
                                    </mat-expansion-panel>
                                </ng-container>
                            </ng-container>
                        </mat-accordion>
                        <div>
                            <button class="mr-3 mt-2" mat-flat-button color="accent" matStepperPrevious>Back</button>
                            <button class="mr-3 mt-2" mat-flat-button color="primary" [disabled]="locationForm.invalid" matStepperNext>Save / Next</button>
                        </div>
                    </form>
                </mat-step>
            </mat-horizontal-stepper>              
        </div>
    </div>
</div>
